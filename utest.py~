#!/usr/bin/python3
# -*- coding: utf-8 -*-

import beansapi

#############
### LEXER ###
#############

lexer = beansapi.Lexer('a')
a = lexer.lex()
assert a.code == beansapi.primitives["VARIABLE"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["EOF"]["code"]

lexer = beansapi.Lexer('b        ="zadpojazd"')
a = lexer.lex()
assert a.code == beansapi.primitives["VARIABLE"]["code"]
assert a.value == "b"
a = lexer.lex()
assert a.code == beansapi.primitives["EQUALS"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["STRING"]["code"]
assert a.value == "zadpojazd"
a = lexer.lex()
assert a.code == beansapi.primitives["EOF"]["code"]

lexer = beansapi.Lexer(';')
a = lexer.lex()
assert a.code == beansapi.primitives["SEMICOLON"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["EOF"]["code"]

lexer = beansapi.Lexer("function b: ();")
a = lexer.lex()
assert a.code == beansapi.primitives["FUNCTION"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["VARIABLE"]["code"]
assert a.value == "b"
a = lexer.lex()
assert a.code == beansapi.primitives["COLON"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["LPAR"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["RPAR"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["SEMICOLON"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["EOF"]["code"]

lexer = beansapi.Lexer("while")
a = lexer.lex()
assert a.code == beansapi.primitives["WHILE"]["code"]
a = lexer.lex()
assert a.code == beansapi.primitives["EOF"]["code"]

##############
### PARSER ###
##############


code = "print(a, c(b))"
lexer = beansapi.Lexer(code)
parser = beansapi.Parser(lexer)
result = parser.parse()
assert type(result[0]) is beansapi.FunctionCallNode
assert result[0].name == "print"
assert type(result[0].arguments[0]) == beansapi.VariableNode
assert result[0].arguments[0].name == "a"
assert type(result[0].arguments[1]) == beansapi.FunctionCallNode
assert result[0].arguments[1].name == "c"
assert type(result[0].arguments[1].arguments[0]) == beansapi.VariableNode
assert result[0].arguments[1].arguments[0].name == "b"


code = """function a: a, b {print(a, b)}"""
result = beansapi.Parser(beansapi.Lexer(code)).parse()
assert type(result[0]) is beansapi.FunctionDefinitionNode
assert result[0].name is 'a'
assert type(result[0].args[0]) is beansapi.VariableNode
assert result[0].args[0].name is 'a'
assert type(result[0].args[1]) is beansapi.VariableNode
assert result[0].args[1].name is 'b'
assert type(result[0].commands[0]) is beansapi.FunctionCallNode
assert type(result[0].commands[0].arguments[0]) is beansapi.VariableNode
assert result[0].commands[0].arguments[0].name == "a"
assert type(result[0].commands[0].arguments[1]) is beansapi.VariableNode
assert  result[0].commands[0].arguments[1].name == "b"

code = """class a: {
method b: {} method c: {}
}
"""

result = beansapi.Parser(beansapi.Lexer(code)).parse()
assert type(result[0]) is beansapi.ClassDefinitionNode
assert result[0].name is 'a'
assert type(result[0]) is beansapi.ClassDefinitionNode


code = """a = a.b.c.d().e().f"""

result = beansapi.Parser(beansapi.Lexer(code)).parse()
assert len(result) == 1
assert type(result[0]) is beansapi.AssignmentNode
assert result[0].name is 'a'
ctnt = result[0].value
assert type(ctnt) is beansapi.VariableNode
assert ctnt.name is 'a'
ctnt = ctnt.child
assert type(ctnt) is beansapi.VariableNode
assert ctnt.name is 'b'
ctnt = ctnt.child
assert type(ctnt) is beansapi.VariableNode
assert ctnt.name is 'c'
ctnt = ctnt.child
assert type(ctnt) is beansapi.FunctionCallNode
assert ctnt.name is 'd'
assert ctnt.arguments == []
ctnt = ctnt.child
assert type(ctnt) is beansapi.FunctionCallNode
assert ctnt.name is 'e'
assert ctnt.arguments == []
ctnt = ctnt.child
assert type(ctnt) is beansapi.VariableNode
assert ctnt.name is 'f'
ctnt = ctnt.child
assert ctnt is None

code = '{"a": ["a", "b"], "c": "d", e: g}'
result = beansapi.Parser(beansapi.Lexer(code)).parse()
assert len(result) == 1
assert type(result[0]) is beansapi.DictNode
ctnt = result[0]
#assert ctnt.value[

print("Everything good!")
